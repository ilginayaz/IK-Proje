@using IKProject.Data.Concrete
@model List<ApplicationUser>

<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>FYHI Admin</title>
    <!-- plugins:css -->
    <link rel="stylesheet" href="~/dashboardcss/vendors/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="~/dashboardcss/vendors/css/vendor.bundle.base.css">
    <!-- endinject -->
    <!-- Plugin css for this page -->
    <link rel="stylesheet" href="~/dashboardcss/vendors/jvectormap/jquery-jvectormap.css">
    <link rel="stylesheet" href="~/dashboardcss/vendors/flag-icon-css/css/flag-icon.min.css">
    <link rel="stylesheet" href="~/dashboardcss/vendors/owl-carousel-2/owl.carousel.min.css">
    <link rel="stylesheet" href="~/dashboardcss/vendors/owl-carousel-2/owl.theme.default.min.css">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="~/dashboardcss/css/style.css">
    <!-- End layout styles -->
    <link rel="shortcut icon" href="~/dashboardcss/images/favicon.png" />
</head>
<body>
    <div>
        <br />
        <br />
        <br />
        <h2>Çalışanlar Listesi</h2>
        <div id="resultMessage" class="alert d-none"></div> <!-- Mesaj Alanı -->
        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th scope="col">Adı Soyadı</th>
                    <th scope="col">E-Posta</th>
                    <th scope="col">Departman</th>
                    <th scope="col">Meslek</th>
                    <th scope="col">Doğum Tarihi</th>
                    <th scope="col">İşe Giriş Tarihi</th>
                    <th scope="col">Telefon</th>
                    <th scope="col">Adres</th>
                    <th>İşlem</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var employee in Model)
                {
                    <tr data-name="@employee.Adi @employee.Soyadi"
                        data-email="@employee.Email"
                        data-departman="@employee.Departman"
                        data-meslek="@employee.Meslek"
                        data-dob="@employee.DogumTarihi.ToString("yyyy-MM-dd")"
                        data-start="@employee.CreatedTime.ToString("yyyy-MM-dd")"
                        data-phone="@employee.TelefonNumarasi"
                        data-address="@employee.Adres"
                        data-department="@employee.Departman"
                        data-status="@employee.Status"
                        data-img="@employee.ProfilePhoto">

                        <td>@employee.Adi @employee.Soyadi</td>
                        <td>@employee.Email</td>
                        <td>@employee.Departman</td>
                        <td></td>
                        <td>@employee.DogumTarihi.ToString("yyyy-MM-dd")</td>
                        <td>@employee.CreatedTime.ToString("yyyy-MM-dd")</td>
                        <td>@employee.TelefonNumarasi</td>
                        <td>@employee.Adres</td>
                        <td>
                            <button class="btn btn-danger sil-btn" data-id="@employee.Email">Sil</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="employeeModal" tabindex="-1" aria-labelledby="employeeModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="employeeModalLabel">Çalışan Bilgileri</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="text-center">
                        <img id="employeeImg" src="~/dashboardcss/images/faces/face5.jpg" alt="Kullanıcı Fotoğrafı" class="img-fluid rounded-circle mb-3" style="width: 150px;">
                    </div>
                    <p><strong>Adı Soyadı:</strong> <span id="employeeName"></span></p>
                    <p><strong>Email:</strong> <span id="employeeEmail"></span></p>
                    <p><strong>Departman:</strong> <span id="employeeDepartman"></span></p>
                    <p><strong>Görevi:</strong> <span id="employeeGorev"></span></p>
                    <p><strong>Doğum Tarihi:</strong> <span id="employeeDogum"></span></p>
                    <p><strong>İşe Giriş Tarihi:</strong> <span id="employeeStart"></span></p>
                    <p><strong>Telefon:</strong> <span id="employeePhone"></span></p>
                    <p><strong>Adres:</strong> <span id="employeeAddress"></span></p>
                    <p><strong>Kalan Yıllık İzin:</strong> <span id="employeeIzin"></span></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Kapat</button>
                </div>
            </div>
        </div>
    </div>
    <!-- container-scroller -->
    <!-- plugins:js -->
    <script src="~/dashboardcss/vendors/js/vendor.bundle.base.js"></script>
    <!-- endinject -->
    <!-- Plugin js for this page -->
    <script src="~/dashboardcss/vendors/chart.js/Chart.min.js"></script>
    <script src="~/dashboardcss/vendors/progressbar.js/progressbar.min.js"></script>
    <script src="~/dashboardcss/vendors/jvectormap/jquery-jvectormap.min.js"></script>
    <script src="~/dashboardcss/vendors/jvectormap/jquery-jvectormap-world-mill-en.js"></script>
    <script src="~/dashboardcss/vendors/owl-carousel-2/owl.carousel.min.js"></script>
    <!-- End plugin js for this page -->
    <!-- inject:js -->
    <script src="~/dashboardcss/js/off-canvas.js"></script>
    <script src="~/dashboardcss/js/hoverable-collapse.js"></script>
    <script src="~/dashboardcss/js/misc.js"></script>
    <script src="~/dashboardcss/js/settings.js"></script>
    <script src="~/dashboardcss/js/todolist.js"></script>
    <!-- endinject -->
    <!-- Custom js for this page -->
    <script src="~/dashboardcss/js/dashboard.js"></script>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/popperjs/core@2.11.5/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function () {
            $('table tbody tr').click(function () {
                // Modal içindeki alanları doldurma
                $('#employeeName').text($(this).data('name'));
                $('#employeeEmail').text($(this).data('email'));
                $('#employeeDepartman').text($(this).data('departman'));
                $('#employeeGorev').text($(this).data('Gorev'));
                $('#employeeDogum').text($(this).data('dob'));
                $('#employeeStart').text($(this).data('start'));
                $('#employeePhone').text($(this).data('phone'));
                $('#employeeAddress').text($(this).data('address'));
                $('#employeeIzin').text($(this).data('izin'));
                $('#employeeImg').attr('src', $(this).data('img'));

                // Modal'ı aç
                $('#employeeModal').modal('show');
            });

            // Sil butonuna tıklama işlemi
            $('.sil-btn').click(function () {
                var email = $(this).data('id'); // E-posta adresini al

                // Onay mesajı göster
                if (confirm('Bu çalışanı silmek istediğinizden emin misiniz?')) {
                    $.ajax({
                        type: "POST",
                        url: '@Url.Action("CalisanSil", "Home", new { area = "CompanyManager" })',
                        data: { email: email }, // E-posta adresini gönder
                        success: function (response) {
                            if (response.success) {
                                // Satırı kaldırma işlemi
                                $('button[data-id="' + email + '"]').closest('tr').remove();
                                showMessage("Personel Silindi!", "success");
                            } else {
                                showMessage("Silme işlemi başarısız oldu.", "danger");
                            }
                        },
                        error: function () {
                            showMessage("Bir hata oluştu.", "danger");
                        }
                    });
                }
            });

            // Mesaj gösterme fonksiyonu
            function showMessage(message, type) {
                var resultMessage = $('#resultMessage');
                resultMessage.removeClass().addClass('alert alert-' + type).text(message).removeClass('d-none');

                // Mesajı birkaç saniye sonra gizle
                setTimeout(function () {
                    resultMessage.addClass('d-none');
                }, 3000);
            }
        });
    </script>

</body>
</html>
